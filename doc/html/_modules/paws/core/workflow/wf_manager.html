<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>paws.core.workflow.wf_manager &#8212; paws 0.4.0 documentation</title>
    
    <link rel="stylesheet" href="../../../../_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../../',
        VERSION:     '0.4.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../../_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" /> 
  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../../index.html">paws 0.4.0 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../../index.html" accesskey="U">Module code</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for paws.core.workflow.wf_manager</h1><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">collections</span> <span class="k">import</span> <span class="n">OrderedDict</span>
<span class="kn">import</span> <span class="nn">copy</span>
<span class="kn">from</span> <span class="nn">functools</span> <span class="k">import</span> <span class="n">partial</span>

<span class="kn">from</span> <span class="nn">PySide</span> <span class="k">import</span> <span class="n">QtCore</span>

<span class="kn">from</span> <span class="nn">..treemodel</span> <span class="k">import</span> <span class="n">TreeModel</span><span class="p">,</span> <span class="n">TreeSelectionModel</span>
<span class="kn">from</span> <span class="nn">..treeitem</span> <span class="k">import</span> <span class="n">TreeItem</span>
<span class="kn">from</span> <span class="nn">..operations</span> <span class="k">import</span> <span class="n">optools</span>
<span class="kn">from</span> <span class="nn">..operations.operation</span> <span class="k">import</span> <span class="n">Operation</span><span class="p">,</span> <span class="n">Batch</span><span class="p">,</span> <span class="n">Realtime</span>
<span class="kn">from</span> <span class="nn">.wf_worker</span> <span class="k">import</span> <span class="n">WfWorker</span>

<div class="viewcode-block" id="WfManager"><a class="viewcode-back" href="../../../../moduledoc_files/paws.core.workflow.html#paws.core.workflow.wf_manager.WfManager">[docs]</a><span class="k">class</span> <span class="nc">WfManager</span><span class="p">(</span><span class="n">TreeSelectionModel</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Tree structure for managing a Workflow built from paws Operations.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">wfdone</span> <span class="o">=</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Signal</span><span class="p">()</span>

    <span class="nd">@QtCore</span><span class="o">.</span><span class="n">Slot</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span><span class="n">Operation</span><span class="p">)</span>
<div class="viewcode-block" id="WfManager.updateOperation"><a class="viewcode-back" href="../../../../moduledoc_files/paws.core.workflow.html#paws.core.workflow.wf_manager.WfManager.updateOperation">[docs]</a>    <span class="k">def</span> <span class="nf">updateOperation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tag</span><span class="p">,</span><span class="n">op</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_op</span><span class="p">(</span><span class="n">tag</span><span class="p">,</span><span class="n">op</span><span class="p">)</span></div>
        
    <span class="c1"># tags and indices for rendering TreeModel portions from Operations</span>
    <span class="n">inputs_tag</span> <span class="o">=</span> <span class="n">optools</span><span class="o">.</span><span class="n">inputs_tag</span> 
    <span class="n">outputs_tag</span> <span class="o">=</span> <span class="n">optools</span><span class="o">.</span><span class="n">outputs_tag</span> 
    <span class="c1">#inputs_idx = 0</span>
    <span class="c1">#outputs_idx = 1</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">qapp_reference</span><span class="p">,</span><span class="n">plugin_manager</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">WfManager</span><span class="p">,</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="c1"># reference to app for helping thread control</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">appref</span> <span class="o">=</span> <span class="n">qapp_reference</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">plugman</span> <span class="o">=</span> <span class="n">plugin_manager</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_wf_dict</span> <span class="o">=</span> <span class="p">{}</span>       
        <span class="c1"># Flags to assist in thread control</span>
        <span class="c1"># TODO: Migrate this to a ThreadPool?</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_running</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_n_threads</span> <span class="o">=</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">QThread</span><span class="o">.</span><span class="n">idealThreadCount</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_n_wf_threads</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_wf_threads</span> <span class="o">=</span> <span class="nb">dict</span><span class="o">.</span><span class="n">fromkeys</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_n_threads</span><span class="p">)[:</span><span class="bp">self</span><span class="o">.</span><span class="n">_n_wf_threads</span><span class="p">])</span> 
        <span class="c1">#self._wf_threads = dict.fromkeys(range(self._n_threads)) </span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logmethod</span> <span class="o">=</span> <span class="kc">None</span>

<div class="viewcode-block" id="WfManager.write_log"><a class="viewcode-back" href="../../../../moduledoc_files/paws.core.workflow.html#paws.core.workflow.wf_manager.WfManager.write_log">[docs]</a>    <span class="k">def</span> <span class="nf">write_log</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">msg</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">logmethod</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logmethod</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">appref</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">appref</span><span class="o">.</span><span class="n">processEvents</span><span class="p">()</span></div>

<div class="viewcode-block" id="WfManager.load_from_dict"><a class="viewcode-back" href="../../../../moduledoc_files/paws.core.workflow.html#paws.core.workflow.wf_manager.WfManager.load_from_dict">[docs]</a>    <span class="k">def</span> <span class="nf">load_from_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">opman</span><span class="p">,</span><span class="n">opdict</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Load things in to the Workflow from an OpManager</span>
<span class="sd">        using a dict that specifies operation setup.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">while</span> <span class="nb">any</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">root_items</span><span class="p">):</span>
            <span class="n">idx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rowCount</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">QModelIndex</span><span class="p">())</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">QtCore</span><span class="o">.</span><span class="n">QModelIndex</span><span class="p">())</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">remove_op</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">uri</span><span class="p">,</span> <span class="n">op_spec</span> <span class="ow">in</span> <span class="n">opdict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">opname</span> <span class="o">=</span> <span class="n">op_spec</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span>
            <span class="n">op</span> <span class="o">=</span> <span class="n">opman</span><span class="o">.</span><span class="n">get_op_byname</span><span class="p">(</span><span class="n">opname</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">op</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">issubclass</span><span class="p">(</span><span class="n">op</span><span class="p">,</span><span class="n">Operation</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">write_log</span><span class="p">(</span><span class="s1">&#39;Did not find Operation </span><span class="si">{}</span><span class="s1"> - skipping.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">opname</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">op</span> <span class="o">=</span> <span class="n">op</span><span class="p">()</span>
                    <span class="n">op</span><span class="o">.</span><span class="n">load_defaults</span><span class="p">()</span>
                    <span class="n">ilspec</span> <span class="o">=</span> <span class="n">op_spec</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">inputs_tag</span><span class="p">]</span>
                    <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">op</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                        <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">ilspec</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                            <span class="n">src</span> <span class="o">=</span> <span class="n">ilspec</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="s1">&#39;src&#39;</span><span class="p">]</span>
                            <span class="c1"># TODO: deprecate &#39;type&#39; tag in favor of &#39;tp&#39;</span>
                            <span class="k">if</span> <span class="s1">&#39;tp&#39;</span> <span class="ow">in</span> <span class="n">ilspec</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                                <span class="n">tp</span> <span class="o">=</span> <span class="n">ilspec</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="s1">&#39;tp&#39;</span><span class="p">]</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">tp</span> <span class="o">=</span> <span class="n">ilspec</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="s1">&#39;type&#39;</span><span class="p">]</span>
                            <span class="n">val</span> <span class="o">=</span> <span class="n">ilspec</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="s1">&#39;val&#39;</span><span class="p">]</span>
                            <span class="k">if</span> <span class="n">tp</span> <span class="ow">in</span> <span class="n">optools</span><span class="o">.</span><span class="n">invalid_types</span><span class="p">[</span><span class="n">src</span><span class="p">]:</span>
                                <span class="n">il</span> <span class="o">=</span> <span class="n">optools</span><span class="o">.</span><span class="n">InputLocator</span><span class="p">(</span><span class="n">src</span><span class="p">,</span><span class="n">optools</span><span class="o">.</span><span class="n">none_type</span><span class="p">,</span><span class="kc">None</span><span class="p">)</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">il</span> <span class="o">=</span> <span class="n">optools</span><span class="o">.</span><span class="n">InputLocator</span><span class="p">(</span><span class="n">src</span><span class="p">,</span><span class="n">tp</span><span class="p">,</span><span class="n">val</span><span class="p">)</span>
                            <span class="n">op</span><span class="o">.</span><span class="n">input_locator</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">il</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">write_log</span><span class="p">(</span><span class="s1">&#39;Did not find input </span><span class="si">{}</span><span class="s1"> for </span><span class="si">{}</span><span class="s1"> - skipping.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="n">opname</span><span class="p">))</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">add_op</span><span class="p">(</span><span class="n">uri</span><span class="p">,</span><span class="n">op</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">write_log</span><span class="p">(</span><span class="s1">&#39;Did not find Operation </span><span class="si">{}</span><span class="s1"> - skipping.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">opname</span><span class="p">))</span></div>
        
<div class="viewcode-block" id="WfManager.load_inputs"><a class="viewcode-back" href="../../../../moduledoc_files/paws.core.workflow.html#paws.core.workflow.wf_manager.WfManager.load_inputs">[docs]</a>    <span class="k">def</span> <span class="nf">load_inputs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">op</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Loads input data for an Operation from that Operation&#39;s input_locators.</span>
<span class="sd">        It is expected that op.input_locator[name] will refer to an InputLocator.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span><span class="n">il</span> <span class="ow">in</span> <span class="n">op</span><span class="o">.</span><span class="n">input_locator</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">il</span><span class="p">,</span><span class="n">optools</span><span class="o">.</span><span class="n">InputLocator</span><span class="p">):</span>
                <span class="n">il</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">locate_input</span><span class="p">(</span><span class="n">il</span><span class="p">)</span>
                <span class="n">op</span><span class="o">.</span><span class="n">inputs</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">il</span><span class="o">.</span><span class="n">data</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="s1">&#39;[</span><span class="si">{}</span><span class="s1">] Found broken Operation.input_locator for </span><span class="si">{}</span><span class="s1">: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="vm">__name__</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">il</span><span class="p">)</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span></div>

<div class="viewcode-block" id="WfManager.locate_input"><a class="viewcode-back" href="../../../../moduledoc_files/paws.core.workflow.html#paws.core.workflow.wf_manager.WfManager.locate_input">[docs]</a>    <span class="k">def</span> <span class="nf">locate_input</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">il</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the data pointed to by a given InputLocator object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">il</span><span class="o">.</span><span class="n">src</span> <span class="o">==</span> <span class="n">optools</span><span class="o">.</span><span class="n">no_input</span> <span class="ow">or</span> <span class="n">il</span><span class="o">.</span><span class="n">tp</span> <span class="o">==</span> <span class="n">optools</span><span class="o">.</span><span class="n">none_type</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">elif</span> <span class="n">il</span><span class="o">.</span><span class="n">src</span> <span class="o">==</span> <span class="n">optools</span><span class="o">.</span><span class="n">batch_input</span><span class="p">:</span>
            <span class="c1"># Expect this input to have been set by self.set_op_input_at_uri().</span>
            <span class="k">return</span> <span class="n">il</span><span class="o">.</span><span class="n">data</span> 
        <span class="k">elif</span> <span class="n">il</span><span class="o">.</span><span class="n">src</span> <span class="o">==</span> <span class="n">optools</span><span class="o">.</span><span class="n">text_input</span><span class="p">:</span> 
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">il</span><span class="o">.</span><span class="n">val</span><span class="p">,</span><span class="nb">list</span><span class="p">):</span>
                <span class="k">return</span> <span class="p">[</span><span class="n">optools</span><span class="o">.</span><span class="n">cast_type_val</span><span class="p">(</span><span class="n">il</span><span class="o">.</span><span class="n">tp</span><span class="p">,</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">il</span><span class="o">.</span><span class="n">val</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">optools</span><span class="o">.</span><span class="n">cast_type_val</span><span class="p">(</span><span class="n">il</span><span class="o">.</span><span class="n">tp</span><span class="p">,</span><span class="n">il</span><span class="o">.</span><span class="n">val</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">il</span><span class="o">.</span><span class="n">src</span> <span class="o">==</span> <span class="n">optools</span><span class="o">.</span><span class="n">wf_input</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">il</span><span class="o">.</span><span class="n">tp</span> <span class="o">==</span> <span class="n">optools</span><span class="o">.</span><span class="n">ref_type</span><span class="p">:</span>
                <span class="c1"># Note, this will return whatever data is stored in the TreeItem at uri.</span>
                <span class="c1"># If il.val is the uri of an input that has not yet been loaded,</span>
                <span class="c1"># this means it will get the InputLocator that currently inhabits that uri.</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">il</span><span class="o">.</span><span class="n">val</span><span class="p">,</span><span class="nb">list</span><span class="p">):</span>
                    <span class="k">return</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">get_from_uri</span><span class="p">(</span><span class="n">v</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">data</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">il</span><span class="o">.</span><span class="n">val</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_from_uri</span><span class="p">(</span><span class="n">il</span><span class="o">.</span><span class="n">val</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>
            <span class="k">elif</span> <span class="n">il</span><span class="o">.</span><span class="n">tp</span> <span class="o">==</span> <span class="n">optools</span><span class="o">.</span><span class="n">path_type</span><span class="p">:</span> 
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">il</span><span class="o">.</span><span class="n">val</span><span class="p">,</span><span class="nb">list</span><span class="p">):</span>
                    <span class="k">return</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">il</span><span class="o">.</span><span class="n">val</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">il</span><span class="o">.</span><span class="n">val</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">il</span><span class="o">.</span><span class="n">src</span> <span class="o">==</span> <span class="n">optools</span><span class="o">.</span><span class="n">plugin_input</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">il</span><span class="o">.</span><span class="n">tp</span> <span class="o">==</span> <span class="n">optools</span><span class="o">.</span><span class="n">ref_type</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">il</span><span class="o">.</span><span class="n">val</span><span class="p">,</span><span class="nb">list</span><span class="p">):</span>
                    <span class="k">return</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">plugman</span><span class="o">.</span><span class="n">get_from_uri</span><span class="p">(</span><span class="n">v</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">data</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">il</span><span class="o">.</span><span class="n">val</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">plugman</span><span class="o">.</span><span class="n">get_from_uri</span><span class="p">(</span><span class="n">il</span><span class="o">.</span><span class="n">val</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>
            <span class="k">elif</span> <span class="n">il</span><span class="o">.</span><span class="n">tp</span> <span class="o">==</span> <span class="n">optools</span><span class="o">.</span><span class="n">path_type</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">il</span><span class="o">.</span><span class="n">val</span><span class="p">,</span><span class="nb">list</span><span class="p">):</span>
                    <span class="k">return</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">il</span><span class="o">.</span><span class="n">val</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">il</span><span class="o">.</span><span class="n">val</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">il</span><span class="o">.</span><span class="n">src</span> <span class="o">==</span> <span class="n">optools</span><span class="o">.</span><span class="n">fs_input</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">il</span><span class="o">.</span><span class="n">val</span><span class="p">,</span><span class="nb">list</span><span class="p">):</span>
                <span class="k">return</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">il</span><span class="o">.</span><span class="n">val</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">il</span><span class="o">.</span><span class="n">val</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span> 
            <span class="n">msg</span> <span class="o">=</span> <span class="s1">&#39;found input source </span><span class="si">{}</span><span class="s1">, should be one of </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">il</span><span class="o">.</span><span class="n">src</span><span class="p">,</span> <span class="n">optools</span><span class="o">.</span><span class="n">valid_sources</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span></div>

<div class="viewcode-block" id="WfManager.add_op"><a class="viewcode-back" href="../../../../moduledoc_files/paws.core.workflow.html#paws.core.workflow.wf_manager.WfManager.add_op">[docs]</a>    <span class="k">def</span> <span class="nf">add_op</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">uri</span><span class="p">,</span><span class="n">new_op</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Add an Operation to the tree as a new top-level TreeItem.&quot;&quot;&quot;</span>
        <span class="c1"># Count top-level rows by passing parent=QModelIndex()</span>
        <span class="n">ins_row</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rowCount</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">QModelIndex</span><span class="p">())</span>
        <span class="n">itm</span> <span class="o">=</span> <span class="n">TreeItem</span><span class="p">(</span><span class="n">ins_row</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">QtCore</span><span class="o">.</span><span class="n">QModelIndex</span><span class="p">())</span>
        <span class="n">itm</span><span class="o">.</span><span class="n">set_tag</span><span class="p">(</span> <span class="n">uri</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">beginInsertRows</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">QModelIndex</span><span class="p">(),</span><span class="n">ins_row</span><span class="p">,</span><span class="n">ins_row</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">root_items</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">ins_row</span><span class="p">,</span><span class="n">itm</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">endInsertRows</span><span class="p">()</span>
        <span class="n">idx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">ins_row</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">QtCore</span><span class="o">.</span><span class="n">QModelIndex</span><span class="p">())</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">tree_update</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span><span class="n">new_op</span><span class="p">)</span></div>

<div class="viewcode-block" id="WfManager.remove_op"><a class="viewcode-back" href="../../../../moduledoc_files/paws.core.workflow.html#paws.core.workflow.wf_manager.WfManager.remove_op">[docs]</a>    <span class="k">def</span> <span class="nf">remove_op</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">rm_idx</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Remove an Operation from the workflow tree&quot;&quot;&quot;</span>
        <span class="n">rm_row</span> <span class="o">=</span> <span class="n">rm_idx</span><span class="o">.</span><span class="n">row</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">beginRemoveRows</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">QModelIndex</span><span class="p">(),</span><span class="n">rm_row</span><span class="p">,</span><span class="n">rm_row</span><span class="p">)</span>
        <span class="n">item_removed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">root_items</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">rm_row</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">endRemoveRows</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tree_dataChanged</span><span class="p">(</span><span class="n">rm_idx</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_io_deps</span><span class="p">()</span></div>

<div class="viewcode-block" id="WfManager.update_op"><a class="viewcode-back" href="../../../../moduledoc_files/paws.core.workflow.html#paws.core.workflow.wf_manager.WfManager.update_op">[docs]</a>    <span class="k">def</span> <span class="nf">update_op</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">uri</span><span class="p">,</span><span class="n">new_op</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Update Operation in treeitem indicated by uri.</span>
<span class="sd">        It is expected that new_op is a reference to the Operation stored at uri. </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">itm</span><span class="p">,</span> <span class="n">idx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_from_uri</span><span class="p">(</span><span class="n">uri</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tree_update</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span><span class="n">new_op</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_io_deps</span><span class="p">()</span></div>

    <span class="c1"># TODO: fix uri_to_dict and update_uri_dict. </span>
    <span class="c1"># Currently e.g. saving op.outputs.pif fails to save the pif,</span>
    <span class="c1"># while saving op.outputs does save the pif.</span>
<div class="viewcode-block" id="WfManager.uri_to_dict"><a class="viewcode-back" href="../../../../moduledoc_files/paws.core.workflow.html#paws.core.workflow.wf_manager.WfManager.uri_to_dict">[docs]</a>    <span class="k">def</span> <span class="nf">uri_to_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">uri</span><span class="p">,</span><span class="n">data</span><span class="p">):</span>
        <span class="n">itm</span><span class="p">,</span><span class="n">idx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_from_uri</span><span class="p">(</span><span class="n">uri</span><span class="p">)</span>
        <span class="n">od</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>
        <span class="n">od</span><span class="p">[</span><span class="n">itm</span><span class="o">.</span><span class="n">tag</span><span class="p">()]</span> <span class="o">=</span> <span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="n">p_idx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span>
        <span class="c1"># if this is a top level item, return od</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">p_idx</span><span class="o">.</span><span class="n">isValid</span><span class="p">():</span>
            <span class="k">return</span> <span class="n">od</span>
        <span class="c1"># else, package od under its parent&#39;s tag</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">uri_to_dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">build_uri</span><span class="p">(</span><span class="n">p_idx</span><span class="p">),</span><span class="n">od</span><span class="p">)</span></div>

    <span class="nd">@staticmethod</span>
<div class="viewcode-block" id="WfManager.update_uri_dict"><a class="viewcode-back" href="../../../../moduledoc_files/paws.core.workflow.html#paws.core.workflow.wf_manager.WfManager.update_uri_dict">[docs]</a>    <span class="k">def</span> <span class="nf">update_uri_dict</span><span class="p">(</span><span class="n">d</span><span class="p">,</span><span class="n">d_new</span><span class="p">):</span>
        <span class="c1">#print &#39;\n-------------\nupdating \n{} \nwith \n{}&#39;.format(d,d_new)</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="n">d_new</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">d</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="n">k</span><span class="p">],</span><span class="nb">dict</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">d_new</span><span class="p">[</span><span class="n">k</span><span class="p">],</span><span class="nb">dict</span><span class="p">):</span>
                    <span class="c1"># embedded dicts: recurse</span>
                    <span class="n">d</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">update_uri_dict</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="n">k</span><span class="p">],</span><span class="n">d_new</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># existing key refers to non-dict: replace</span>
                    <span class="n">d</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">d_new</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># no entry for this key: insert</span>
                <span class="n">d</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>
        <span class="c1">#print &#39;result: \n{} \n---------&#39;.format(d)</span>
        <span class="k">return</span> <span class="n">d</span></div>

<div class="viewcode-block" id="WfManager.build_dict"><a class="viewcode-back" href="../../../../moduledoc_files/paws.core.workflow.html#paws.core.workflow.wf_manager.WfManager.build_dict">[docs]</a>    <span class="k">def</span> <span class="nf">build_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">x</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Overloaded build_dict to handle Operations.</span>
<span class="sd">        Base class method builds dicts from other data types.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">Operation</span><span class="p">):</span>
            <span class="n">d</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>
            <span class="n">inp_dict</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">nm</span> <span class="ow">in</span> <span class="n">x</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">inputs</span><span class="p">[</span><span class="n">nm</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">inp_dict</span><span class="p">[</span><span class="n">nm</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">inputs</span><span class="p">[</span><span class="n">nm</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">inp_dict</span><span class="p">[</span><span class="n">nm</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">input_locator</span><span class="p">[</span><span class="n">nm</span><span class="p">]</span>
            <span class="n">d</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">inputs_tag</span><span class="p">]</span> <span class="o">=</span> <span class="n">inp_dict</span> 
            <span class="n">d</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">outputs_tag</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">outputs</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">d</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">WfManager</span><span class="p">,</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">build_dict</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">d</span></div>

    <span class="c1"># TODO: Add checking of plugins (il.src == optools.plugin_input)</span>
    <span class="c1"># TODO: Add checking of fs paths (il.src == optools.fs_input)</span>
<div class="viewcode-block" id="WfManager.update_io_deps"><a class="viewcode-back" href="../../../../moduledoc_files/paws.core.workflow.html#paws.core.workflow.wf_manager.WfManager.update_io_deps">[docs]</a>    <span class="k">def</span> <span class="nf">update_io_deps</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Remove any broken dependencies in the workflow.</span>
<span class="sd">        Should only be called after all current data have been stored in the tree. </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">r</span><span class="p">,</span><span class="n">itm</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">root_items</span><span class="p">)),</span><span class="bp">self</span><span class="o">.</span><span class="n">root_items</span><span class="p">):</span>
            <span class="n">op</span> <span class="o">=</span> <span class="n">itm</span><span class="o">.</span><span class="n">data</span>
            <span class="n">op_idx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">r</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">QtCore</span><span class="o">.</span><span class="n">QModelIndex</span><span class="p">())</span>
            <span class="k">for</span> <span class="n">name</span><span class="p">,</span><span class="n">il</span> <span class="ow">in</span> <span class="n">op</span><span class="o">.</span><span class="n">input_locator</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">il</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">il</span><span class="o">.</span><span class="n">src</span> <span class="o">==</span> <span class="n">optools</span><span class="o">.</span><span class="n">wf_input</span> <span class="ow">and</span> <span class="n">il</span><span class="o">.</span><span class="n">tp</span> <span class="o">==</span> <span class="n">optools</span><span class="o">.</span><span class="n">ref_type</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_good_uri</span><span class="p">(</span><span class="n">il</span><span class="o">.</span><span class="n">val</span><span class="p">):</span>
                        <span class="c1">#vals = optools.val_list(il)</span>
                        <span class="c1">#for v in vals:</span>
                        <span class="c1">#    if not self.is_good_uri(v):</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">write_log</span><span class="p">(</span><span class="s1">&#39;--- clearing InputLocator for </span><span class="si">{}</span><span class="s1">.</span><span class="si">{}</span><span class="s1">.</span><span class="si">{}</span><span class="s1"> ---&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                        <span class="n">itm</span><span class="o">.</span><span class="n">tag</span><span class="p">(),</span><span class="bp">self</span><span class="o">.</span><span class="n">inputs_tag</span><span class="p">,</span><span class="n">name</span><span class="p">))</span>
                        <span class="n">op</span><span class="o">.</span><span class="n">input_locator</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">optools</span><span class="o">.</span><span class="n">InputLocator</span><span class="p">(</span><span class="n">il</span><span class="o">.</span><span class="n">src</span><span class="p">,</span><span class="n">il</span><span class="o">.</span><span class="n">tp</span><span class="p">,</span><span class="kc">None</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">tree_dataChanged</span><span class="p">(</span><span class="n">op_idx</span><span class="p">)</span></div>

    <span class="c1"># TODO: the following</span>
<div class="viewcode-block" id="WfManager.check_wf"><a class="viewcode-back" href="../../../../moduledoc_files/paws.core.workflow.html#paws.core.workflow.wf_manager.WfManager.check_wf">[docs]</a>    <span class="k">def</span> <span class="nf">check_wf</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Check the dependencies of the workflow.</span>
<span class="sd">        Ensure that all loaded operations have inputs that make sense.</span>
<span class="sd">        Return a status code and message for each of the Operations.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">pass</span></div>

<div class="viewcode-block" id="WfManager.is_running"><a class="viewcode-back" href="../../../../moduledoc_files/paws.core.workflow.html#paws.core.workflow.wf_manager.WfManager.is_running">[docs]</a>    <span class="k">def</span> <span class="nf">is_running</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_running</span></div>

<div class="viewcode-block" id="WfManager.stop_wf"><a class="viewcode-back" href="../../../../moduledoc_files/paws.core.workflow.html#paws.core.workflow.wf_manager.WfManager.stop_wf">[docs]</a>    <span class="k">def</span> <span class="nf">stop_wf</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_running</span> <span class="o">=</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="WfManager.get_valid_wf_inputs"><a class="viewcode-back" href="../../../../moduledoc_files/paws.core.workflow.html#paws.core.workflow.wf_manager.WfManager.get_valid_wf_inputs">[docs]</a>    <span class="k">def</span> <span class="nf">get_valid_wf_inputs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">itm</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return all of the TreeModel uris of itm and its children</span>
<span class="sd">        which can be used as downstream inputs in the workflow.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># valid_wf_inputs gains the operation, its input and output dicts, and their respective entries</span>
        <span class="n">valid_wf_inputs</span> <span class="o">=</span> <span class="p">[</span><span class="n">itm</span><span class="o">.</span><span class="n">tag</span><span class="p">(),</span><span class="n">itm</span><span class="o">.</span><span class="n">tag</span><span class="p">()</span><span class="o">+</span><span class="s1">&#39;.&#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">inputs_tag</span><span class="p">,</span><span class="n">itm</span><span class="o">.</span><span class="n">tag</span><span class="p">()</span><span class="o">+</span><span class="s1">&#39;.&#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">outputs_tag</span><span class="p">]</span>
        <span class="n">valid_wf_inputs</span> <span class="o">+=</span> <span class="p">[</span><span class="n">itm</span><span class="o">.</span><span class="n">tag</span><span class="p">()</span><span class="o">+</span><span class="s1">&#39;.&#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">outputs_tag</span><span class="o">+</span><span class="s1">&#39;.&#39;</span><span class="o">+</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">itm</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">outputs</span><span class="o">.</span><span class="n">keys</span><span class="p">()]</span>
        <span class="n">valid_wf_inputs</span> <span class="o">+=</span> <span class="p">[</span><span class="n">itm</span><span class="o">.</span><span class="n">tag</span><span class="p">()</span><span class="o">+</span><span class="s1">&#39;.&#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">inputs_tag</span><span class="o">+</span><span class="s1">&#39;.&#39;</span><span class="o">+</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">itm</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">keys</span><span class="p">()]</span>
        <span class="k">return</span> <span class="n">valid_wf_inputs</span></div>
    
<div class="viewcode-block" id="WfManager.execution_stack"><a class="viewcode-back" href="../../../../moduledoc_files/paws.core.workflow.html#paws.core.workflow.wf_manager.WfManager.execution_stack">[docs]</a>    <span class="k">def</span> <span class="nf">execution_stack</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Build a stack (list) of lists of TreeItems,</span>
<span class="sd">        such that each TreeItem list contains a set of Operations</span>
<span class="sd">        whose dependencies are satisfied by the operations above them.</span>
<span class="sd">        For Batch or Realtime operations, the layer should be of the form[batch_item,batch_stack],</span>
<span class="sd">        where batch_item.data is the batch controller Operation,</span>
<span class="sd">        and batch_stack is built from self.batch_op_stack().</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">stk</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">valid_wf_inputs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">continue_flag</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">while</span> <span class="ow">not</span> <span class="n">optools</span><span class="o">.</span><span class="n">stack_size</span><span class="p">(</span><span class="n">stk</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">root_items</span><span class="p">)</span> <span class="ow">and</span> <span class="n">continue_flag</span><span class="p">:</span>
            <span class="n">items_rdy</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">itm</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">root_items</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">optools</span><span class="o">.</span><span class="n">stack_contains</span><span class="p">(</span><span class="n">itm</span><span class="p">,</span><span class="n">stk</span><span class="p">):</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_op_ready</span><span class="p">(</span><span class="n">itm</span><span class="p">,</span><span class="n">valid_wf_inputs</span><span class="p">):</span>
                        <span class="n">items_rdy</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">itm</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">items_rdy</span><span class="p">):</span>
                <span class="c1"># Which of these are not Batch/Realtime ops?</span>
                <span class="n">non_batch_rdy</span> <span class="o">=</span> <span class="p">[</span><span class="n">itm</span> <span class="k">for</span> <span class="n">itm</span> <span class="ow">in</span> <span class="n">items_rdy</span> <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">itm</span><span class="o">.</span><span class="n">data</span><span class="p">,</span><span class="n">Batch</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">itm</span><span class="o">.</span><span class="n">data</span><span class="p">,</span><span class="n">Realtime</span><span class="p">)]</span>
                <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">non_batch_rdy</span><span class="p">):</span>
                    <span class="n">items_rdy</span> <span class="o">=</span> <span class="n">non_batch_rdy</span>
                    <span class="n">stk</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">items_rdy</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">itm</span> <span class="ow">in</span> <span class="n">items_rdy</span><span class="p">:</span>
                        <span class="n">valid_wf_inputs</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_valid_wf_inputs</span><span class="p">(</span><span class="n">itm</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">b_rt_itm</span> <span class="o">=</span> <span class="n">items_rdy</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">items_rdy</span> <span class="o">=</span> <span class="p">[</span><span class="n">b_rt_itm</span><span class="p">]</span>
                    <span class="n">b_rt_stk</span><span class="p">,</span><span class="n">b_rt_rdy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">batch_op_stack</span><span class="p">(</span><span class="n">b_rt_itm</span><span class="p">,</span><span class="n">valid_wf_inputs</span><span class="p">)</span>
                    <span class="n">stk</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">b_rt_itm</span><span class="p">,</span><span class="n">b_rt_stk</span><span class="p">])</span>
                    <span class="n">valid_wf_inputs</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_valid_wf_inputs</span><span class="p">(</span><span class="n">b_rt_itm</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">continue_flag</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="c1">#print &#39;RESOLVED A STACK&#39;</span>
        <span class="c1">#print &#39;STACK PRINTOUT:&#39;</span>
        <span class="c1">#print optools.print_stack(stk)</span>
        <span class="k">return</span> <span class="n">stk</span></div>

<div class="viewcode-block" id="WfManager.is_op_ready"><a class="viewcode-back" href="../../../../moduledoc_files/paws.core.workflow.html#paws.core.workflow.wf_manager.WfManager.is_op_ready">[docs]</a>    <span class="k">def</span> <span class="nf">is_op_ready</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">itm</span><span class="p">,</span><span class="n">valid_wf_inputs</span><span class="p">,</span><span class="n">batch_routes</span><span class="o">=</span><span class="p">[]):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">itm</span><span class="o">.</span><span class="n">data</span><span class="p">,</span><span class="n">Batch</span><span class="p">):</span>
            <span class="n">b_stk</span><span class="p">,</span><span class="n">op_rdy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">batch_op_stack</span><span class="p">(</span><span class="n">itm</span><span class="p">,</span><span class="n">valid_wf_inputs</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">itm</span><span class="o">.</span><span class="n">data</span><span class="p">,</span><span class="n">Realtime</span><span class="p">):</span>
            <span class="n">rt_stk</span><span class="p">,</span><span class="n">op_rdy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">batch_op_stack</span><span class="p">(</span><span class="n">itm</span><span class="p">,</span><span class="n">valid_wf_inputs</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">op</span> <span class="o">=</span> <span class="n">itm</span><span class="o">.</span><span class="n">data</span>
            <span class="n">inputs_rdy</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">name</span><span class="p">,</span><span class="n">il</span> <span class="ow">in</span> <span class="n">op</span><span class="o">.</span><span class="n">input_locator</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="c1"># TODO: Come up with a more airtight set of conditions here.</span>
                <span class="k">if</span> <span class="n">il</span><span class="o">.</span><span class="n">src</span> <span class="o">==</span> <span class="n">optools</span><span class="o">.</span><span class="n">wf_input</span> <span class="ow">and</span> <span class="n">il</span><span class="o">.</span><span class="n">tp</span> <span class="o">==</span> <span class="n">optools</span><span class="o">.</span><span class="n">ref_type</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">il</span><span class="o">.</span><span class="n">val</span> <span class="ow">in</span> <span class="n">valid_wf_inputs</span><span class="p">:</span>
                    <span class="n">inp_rdy</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="k">elif</span> <span class="n">il</span><span class="o">.</span><span class="n">src</span> <span class="o">==</span> <span class="n">optools</span><span class="o">.</span><span class="n">batch_input</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">itm</span><span class="o">.</span><span class="n">tag</span><span class="p">()</span><span class="o">+</span><span class="s1">&#39;.&#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">inputs_tag</span><span class="o">+</span><span class="s1">&#39;.&#39;</span><span class="o">+</span><span class="n">name</span> <span class="ow">in</span> <span class="n">batch_routes</span><span class="p">:</span>
                    <span class="n">inp_rdy</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">inp_rdy</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="n">inputs_rdy</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">inp_rdy</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">all</span><span class="p">(</span><span class="n">inputs_rdy</span><span class="p">):</span>
                <span class="n">op_rdy</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">op_rdy</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="n">op_rdy</span> </div>

<div class="viewcode-block" id="WfManager.batch_op_stack"><a class="viewcode-back" href="../../../../moduledoc_files/paws.core.workflow.html#paws.core.workflow.wf_manager.WfManager.batch_op_stack">[docs]</a>    <span class="k">def</span> <span class="nf">batch_op_stack</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">b_itm</span><span class="p">,</span><span class="n">valid_wf_inputs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Use b_itm.data.batch_ops() and a list of valid_wf_inputs </span>
<span class="sd">        (a list of uris that are good inputs from the workflow)   </span>
<span class="sd">        to build a stack (list) of lists of operations </span>
<span class="sd">        such that all Operations in the stack have their dependencies satisfied</span>
<span class="sd">        by the Operations above them.     </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">b_itm</span><span class="o">.</span><span class="n">data</span><span class="p">,</span><span class="n">Realtime</span><span class="p">):</span>
            <span class="n">exec_itms</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">get_from_uri</span><span class="p">(</span><span class="n">uri</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">uri</span> <span class="ow">in</span> <span class="n">b_itm</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">realtime_ops</span><span class="p">()]</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">b_itm</span><span class="o">.</span><span class="n">data</span><span class="p">,</span><span class="n">Batch</span><span class="p">):</span>
            <span class="n">exec_itms</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">get_from_uri</span><span class="p">(</span><span class="n">uri</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">uri</span> <span class="ow">in</span> <span class="n">b_itm</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">batch_ops</span><span class="p">()]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">exec_itms</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1"># make a copy of valid_wf_inputs and add the batch&#39;s own i/o items to the list</span>
        <span class="n">valid_batch_inputs</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">valid_wf_inputs</span><span class="p">)</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">get_valid_wf_inputs</span><span class="p">(</span><span class="n">b_itm</span><span class="p">)</span>
        <span class="n">layer</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">test_itm</span> <span class="ow">in</span> <span class="n">exec_itms</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_op_ready</span><span class="p">(</span><span class="n">test_itm</span><span class="p">,</span><span class="n">valid_batch_inputs</span><span class="p">,</span><span class="n">b_itm</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">input_routes</span><span class="p">()):</span>
                <span class="n">layer</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">test_itm</span><span class="p">)</span>
        <span class="n">b_stk</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">while</span> <span class="nb">any</span><span class="p">(</span><span class="n">layer</span><span class="p">):</span>
            <span class="n">b_stk</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">layer</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">itm</span> <span class="ow">in</span> <span class="n">layer</span><span class="p">:</span>
                <span class="n">valid_batch_inputs</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_valid_wf_inputs</span><span class="p">(</span><span class="n">itm</span><span class="p">)</span>
            <span class="n">layer</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">test_itm</span> <span class="ow">in</span> <span class="n">exec_itms</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_op_ready</span><span class="p">(</span><span class="n">test_itm</span><span class="p">,</span><span class="n">valid_batch_inputs</span><span class="p">,</span><span class="n">b_itm</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">input_routes</span><span class="p">())</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">optools</span><span class="o">.</span><span class="n">stack_contains</span><span class="p">(</span><span class="n">test_itm</span><span class="p">,</span><span class="n">b_stk</span><span class="p">):</span>
                    <span class="n">layer</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">test_itm</span><span class="p">)</span>
        <span class="n">b_rdy</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">exec_itms</span><span class="p">)</span> <span class="o">==</span> <span class="n">optools</span><span class="o">.</span><span class="n">stack_size</span><span class="p">(</span><span class="n">b_stk</span><span class="p">)</span> 
        <span class="k">return</span> <span class="n">b_stk</span><span class="p">,</span><span class="n">b_rdy</span> </div>

<div class="viewcode-block" id="WfManager.next_available_thread"><a class="viewcode-back" href="../../../../moduledoc_files/paws.core.workflow.html#paws.core.workflow.wf_manager.WfManager.next_available_thread">[docs]</a>    <span class="k">def</span> <span class="nf">next_available_thread</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span><span class="n">th</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wf_threads</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">th</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">idx</span>
        <span class="c1"># if none found, wait for first thread in self._wf_threads </span>
        <span class="c1"># TODO: migrate threading to a ThreadPool </span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wait_for_thread</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">return</span> <span class="mi">0</span></div>

<div class="viewcode-block" id="WfManager.wait_for_thread"><a class="viewcode-back" href="../../../../moduledoc_files/paws.core.workflow.html#paws.core.workflow.wf_manager.WfManager.wait_for_thread">[docs]</a>    <span class="k">def</span> <span class="nf">wait_for_thread</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">th_idx</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Wait for the thread at self._wf_threads[th_idx] to be finished&quot;&quot;&quot;</span>
        <span class="c1"># TODO: migrate threading to a ThreadPool </span>
        <span class="n">done</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">interval</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">wait_iter</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">total_wait</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">while</span> <span class="ow">not</span> <span class="n">done</span><span class="p">:</span>
            <span class="n">done</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wf_threads</span><span class="p">[</span><span class="n">th_idx</span><span class="p">]:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wf_threads</span><span class="p">[</span><span class="n">th_idx</span><span class="p">]</span><span class="o">.</span><span class="n">isFinished</span><span class="p">():</span>
                    <span class="n">done</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">done</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">wait_iter</span> <span class="o">==</span> <span class="mi">10</span><span class="p">:</span>
                        <span class="n">interval</span> <span class="o">*=</span> <span class="mi">10</span>
                    <span class="k">if</span> <span class="n">wait_iter</span> <span class="o">==</span> <span class="mi">100</span><span class="p">:</span>
                        <span class="n">interval</span> <span class="o">*=</span> <span class="mi">10</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">loopwait</span><span class="p">(</span><span class="n">interval</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">appref</span><span class="o">.</span><span class="n">processEvents</span><span class="p">()</span>
                    <span class="n">wait_iter</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="n">total_wait</span> <span class="o">+=</span> <span class="n">interval</span>
                    <span class="k">if</span> <span class="n">interval</span> <span class="o">&gt;</span> <span class="nb">float</span><span class="p">(</span><span class="n">total_wait</span><span class="p">)</span><span class="o">*</span><span class="mf">0.1</span> <span class="ow">and</span> <span class="n">interval</span> <span class="o">&lt;</span> <span class="mi">100</span><span class="p">:</span>
                        <span class="n">interval</span> <span class="o">=</span> <span class="n">interval</span> <span class="o">*</span> <span class="mi">10</span></div>

<div class="viewcode-block" id="WfManager.wait_for_threads"><a class="viewcode-back" href="../../../../moduledoc_files/paws.core.workflow.html#paws.core.workflow.wf_manager.WfManager.wait_for_threads">[docs]</a>    <span class="k">def</span> <span class="nf">wait_for_threads</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Wait for all workflow execution threads to finish&quot;&quot;&quot;</span>
        <span class="c1"># TODO: migrate threading to a ThreadPool </span>
        <span class="n">done</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">interval</span> <span class="o">=</span> <span class="mi">10</span>
        <span class="n">wait_iter</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span><span class="n">th</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wf_threads</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">wait_for_thread</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span></div>

<div class="viewcode-block" id="WfManager.finish_thread"><a class="viewcode-back" href="../../../../moduledoc_files/paws.core.workflow.html#paws.core.workflow.wf_manager.WfManager.finish_thread">[docs]</a>    <span class="k">def</span> <span class="nf">finish_thread</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">th_idx</span><span class="p">):</span>
        <span class="c1"># TODO: migrate threading to a ThreadPool </span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_wf_threads</span><span class="p">[</span><span class="n">th_idx</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="WfManager.loopwait"><a class="viewcode-back" href="../../../../moduledoc_files/paws.core.workflow.html#paws.core.workflow.wf_manager.WfManager.loopwait">[docs]</a>    <span class="k">def</span> <span class="nf">loopwait</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">interval</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create an event loop to delay some time without busywaiting.</span>
<span class="sd">        Time interval is specified in milliseconds.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">l</span> <span class="o">=</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">QEventLoop</span><span class="p">()</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">QTimer</span><span class="p">()</span>
        <span class="n">t</span><span class="o">.</span><span class="n">setSingleShot</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">t</span><span class="o">.</span><span class="n">timeout</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">l</span><span class="o">.</span><span class="n">quit</span><span class="p">)</span>
        <span class="n">t</span><span class="o">.</span><span class="n">start</span><span class="p">(</span><span class="n">interval</span><span class="p">)</span>
        <span class="n">l</span><span class="o">.</span><span class="n">exec_</span><span class="p">()</span>
        <span class="c1"># processEvents() to continue the main event loop while waiting.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">appref</span><span class="o">.</span><span class="n">processEvents</span><span class="p">()</span></div>

<div class="viewcode-block" id="WfManager.run_wf"><a class="viewcode-back" href="../../../../moduledoc_files/paws.core.workflow.html#paws.core.workflow.wf_manager.WfManager.run_wf">[docs]</a>    <span class="k">def</span> <span class="nf">run_wf</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_running</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">stk</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">execution_stack</span><span class="p">()</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="s1">&#39;STARTING EXECUTION</span><span class="se">\n</span><span class="s1">----</span><span class="se">\n</span><span class="s1">execution stack: </span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">msg</span> <span class="o">+=</span> <span class="n">optools</span><span class="o">.</span><span class="n">print_stack</span><span class="p">(</span><span class="n">stk</span><span class="p">)</span>
        <span class="n">msg</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">----&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write_log</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="n">batch_flags</span> <span class="o">=</span> <span class="p">[</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">itm_lst</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">,</span><span class="n">Batch</span><span class="p">)</span> <span class="k">for</span> <span class="n">itm_lst</span> <span class="ow">in</span> <span class="n">stk</span><span class="p">]</span>
        <span class="n">rt_flags</span> <span class="o">=</span> <span class="p">[</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">itm_lst</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">,</span><span class="n">Realtime</span><span class="p">)</span> <span class="k">for</span> <span class="n">itm_lst</span> <span class="ow">in</span> <span class="n">stk</span><span class="p">]</span>
        <span class="n">layers_done</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">while</span> <span class="ow">not</span> <span class="n">layers_done</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">stk</span><span class="p">):</span> 
            <span class="c1"># check if we are at a batch or rt op</span>
            <span class="k">if</span> <span class="n">batch_flags</span><span class="p">[</span><span class="n">layers_done</span><span class="p">]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">run_wf_batch</span><span class="p">(</span><span class="n">stk</span><span class="p">[</span><span class="n">layers_done</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="n">stk</span><span class="p">[</span><span class="n">layers_done</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
                <span class="n">layers_done</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">elif</span> <span class="n">rt_flags</span><span class="p">[</span><span class="n">layers_done</span><span class="p">]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">run_wf_realtime</span><span class="p">(</span><span class="n">stk</span><span class="p">[</span><span class="n">layers_done</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="n">stk</span><span class="p">[</span><span class="n">layers_done</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
                <span class="n">layers_done</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># get the portion of the stack from here to the next batch or rt op</span>
                <span class="k">if</span> <span class="p">(</span><span class="kc">True</span> <span class="ow">in</span> <span class="n">batch_flags</span><span class="p">[</span><span class="n">layers_done</span><span class="p">:]):</span>
                    <span class="n">substk</span> <span class="o">=</span> <span class="n">stk</span><span class="p">[</span><span class="n">layers_done</span><span class="p">:</span><span class="n">layers_done</span><span class="o">+</span><span class="n">batch_flags</span><span class="p">[</span><span class="n">layers_done</span><span class="p">:]</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="kc">True</span><span class="p">)]</span>
                <span class="k">elif</span> <span class="p">(</span><span class="kc">True</span> <span class="ow">in</span> <span class="n">rt_flags</span><span class="p">[</span><span class="n">layers_done</span><span class="p">:]):</span>
                    <span class="n">substk</span> <span class="o">=</span> <span class="n">stk</span><span class="p">[</span><span class="n">layers_done</span><span class="p">:</span><span class="n">layers_done</span><span class="o">+</span><span class="n">rt_flags</span><span class="p">[</span><span class="n">layers_done</span><span class="p">:]</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="kc">True</span><span class="p">)]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">substk</span> <span class="o">=</span> <span class="n">stk</span><span class="p">[</span><span class="n">layers_done</span><span class="p">:]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">run_wf_serial</span><span class="p">(</span><span class="n">substk</span><span class="p">)</span>
                <span class="n">layers_done</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">substk</span><span class="p">)</span>
        <span class="c1"># if not yet interrupted, signal done</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_running</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">wfdone</span><span class="o">.</span><span class="n">emit</span><span class="p">()</span></div>

<div class="viewcode-block" id="WfManager.run_wf_serial"><a class="viewcode-back" href="../../../../moduledoc_files/paws.core.workflow.html#paws.core.workflow.wf_manager.WfManager.run_wf_serial">[docs]</a>    <span class="k">def</span> <span class="nf">run_wf_serial</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">stk</span><span class="p">,</span><span class="n">thd_idx</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Serially execute the operations contained in the stack stk.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">thd_idx</span><span class="p">:</span>
            <span class="n">thd_idx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">next_available_thread</span><span class="p">()</span>
        <span class="c1">#self.write_log(&#39;SERIAL EXECUTION STARTING in thread {}&#39;.format(thd_idx))</span>
        <span class="k">for</span> <span class="n">lst</span> <span class="ow">in</span> <span class="n">stk</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">wait_for_thread</span><span class="p">(</span><span class="n">thd_idx</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">itm</span> <span class="ow">in</span> <span class="n">lst</span><span class="p">:</span> 
                <span class="n">op</span> <span class="o">=</span> <span class="n">itm</span><span class="o">.</span><span class="n">data</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">load_inputs</span><span class="p">(</span><span class="n">op</span><span class="p">)</span>
            <span class="c1"># Make a new Worker, give None parent so that it can be thread-mobile</span>
            <span class="n">wf_wkr</span> <span class="o">=</span> <span class="n">WfWorker</span><span class="p">(</span><span class="n">lst</span><span class="p">,</span><span class="kc">None</span><span class="p">)</span>
            <span class="n">wf_wkr</span><span class="o">.</span><span class="n">opDone</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">updateOperation</span><span class="p">)</span>
            <span class="n">wf_thread</span> <span class="o">=</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">QThread</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
            <span class="n">wf_wkr</span><span class="o">.</span><span class="n">moveToThread</span><span class="p">(</span><span class="n">wf_thread</span><span class="p">)</span>
            <span class="n">wf_thread</span><span class="o">.</span><span class="n">started</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">wf_wkr</span><span class="o">.</span><span class="n">work</span><span class="p">)</span>
            <span class="n">wf_thread</span><span class="o">.</span><span class="n">finished</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span> <span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">finish_thread</span><span class="p">,</span><span class="n">thd_idx</span><span class="p">)</span> <span class="p">)</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s1">&#39;running </span><span class="si">{}</span><span class="s1"> in thread </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">([</span><span class="n">itm</span><span class="o">.</span><span class="n">tag</span><span class="p">()</span> <span class="k">for</span> <span class="n">itm</span> <span class="ow">in</span> <span class="n">lst</span><span class="p">],</span><span class="n">thd_idx</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">write_log</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_wf_threads</span><span class="p">[</span><span class="n">thd_idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">wf_thread</span>
            <span class="n">wf_thread</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wait_for_thread</span><span class="p">(</span><span class="n">thd_idx</span><span class="p">)</span></div>
        <span class="c1">#self.write_log(&#39;SERIAL EXECUTION FINISHED in thread {}&#39;.format(thd_idx))</span>

<div class="viewcode-block" id="WfManager.run_wf_realtime"><a class="viewcode-back" href="../../../../moduledoc_files/paws.core.workflow.html#paws.core.workflow.wf_manager.WfManager.run_wf_realtime">[docs]</a>    <span class="k">def</span> <span class="nf">run_wf_realtime</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">rt_itm</span><span class="p">,</span><span class="n">stk</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Executes the workflow under the control of one Realtime controller Operation,</span>
<span class="sd">        where the realtime controller Operation is found at rt_itm.data.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1">#self.write_log( &#39;Preparing Realtime controller... &#39; )</span>
        <span class="n">rt</span> <span class="o">=</span> <span class="n">rt_itm</span><span class="o">.</span><span class="n">data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load_inputs</span><span class="p">(</span><span class="n">rt</span><span class="p">)</span>
        <span class="n">rt</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_op</span><span class="p">(</span><span class="n">rt_itm</span><span class="o">.</span><span class="n">tag</span><span class="p">(),</span><span class="n">rt</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">appref</span><span class="o">.</span><span class="n">processEvents</span><span class="p">()</span>
        <span class="n">nx</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">_running</span><span class="p">:</span>
            <span class="c1"># TODO: Ensure rt execution runs smoothly on an initially empty input_iter().</span>
            <span class="c1"># TODO: Add a way to stop a realtime execution without stopping the whole workflow.</span>
            <span class="c1"># After rt.run(), it is expected that rt.input_iter()</span>
            <span class="c1"># will generate lists of input values whose respective routes are rt.input_routes().</span>
            <span class="c1"># unless there are no new inputs to run, in which case it will iterate None. </span>
            <span class="n">vals</span> <span class="o">=</span> <span class="n">rt</span><span class="o">.</span><span class="n">input_iter</span><span class="p">()</span><span class="o">.</span><span class="n">next</span><span class="p">()</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">in</span> <span class="n">vals</span><span class="p">:</span>
                <span class="n">inp_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span> <span class="nb">zip</span><span class="p">(</span><span class="n">rt</span><span class="o">.</span><span class="n">input_routes</span><span class="p">(),</span> <span class="n">vals</span><span class="p">)</span> <span class="p">)</span>
                <span class="c1">#if inp_dict and not None in vals:</span>
                <span class="n">waiting_flag</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="n">nx</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">for</span> <span class="n">uri</span><span class="p">,</span><span class="n">val</span> <span class="ow">in</span> <span class="n">inp_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">set_op_input_at_uri</span><span class="p">(</span><span class="n">uri</span><span class="p">,</span><span class="n">val</span><span class="p">)</span>
                <span class="n">thd</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">next_available_thread</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">write_log</span><span class="p">(</span> <span class="s1">&#39;REALTIME EXECUTION </span><span class="si">{}</span><span class="s1"> in thread </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">nx</span><span class="p">,</span><span class="n">thd</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">run_wf_serial</span><span class="p">(</span><span class="n">stk</span><span class="p">,</span><span class="n">thd</span><span class="p">)</span>
                <span class="n">opdict</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>
                <span class="k">for</span> <span class="n">uri</span> <span class="ow">in</span> <span class="n">rt</span><span class="o">.</span><span class="n">saved_items</span><span class="p">():</span>
                    <span class="n">itm</span><span class="p">,</span><span class="n">idx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_from_uri</span><span class="p">(</span><span class="n">uri</span><span class="p">)</span>
                    <span class="n">itm_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">uri_to_dict</span><span class="p">(</span><span class="n">uri</span><span class="p">,</span><span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">itm</span><span class="o">.</span><span class="n">data</span><span class="p">))</span>
                    <span class="n">opdict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">update_uri_dict</span><span class="p">(</span><span class="n">opdict</span><span class="p">,</span><span class="n">itm_dict</span><span class="p">)</span>
                <span class="n">rt</span><span class="o">.</span><span class="n">output_list</span><span class="p">()</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">opdict</span><span class="p">)</span>
                <span class="c1"># TODO: not a full op update here- just update the new/changed children of the rt op</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">update_op</span><span class="p">(</span><span class="n">rt_itm</span><span class="o">.</span><span class="n">tag</span><span class="p">(),</span><span class="n">rt</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">waiting_flag</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">write_log</span><span class="p">(</span> <span class="s1">&#39;Waiting for new inputs...&#39;</span> <span class="p">)</span>
                <span class="n">waiting_flag</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">loopwait</span><span class="p">(</span><span class="n">rt</span><span class="o">.</span><span class="n">delay</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write_log</span><span class="p">(</span> <span class="s1">&#39;REALTIME EXECUTION TERMINATED&#39;</span> <span class="p">)</span>
        <span class="k">return</span></div>

<div class="viewcode-block" id="WfManager.run_wf_batch"><a class="viewcode-back" href="../../../../moduledoc_files/paws.core.workflow.html#paws.core.workflow.wf_manager.WfManager.run_wf_batch">[docs]</a>    <span class="k">def</span> <span class="nf">run_wf_batch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">b_itm</span><span class="p">,</span><span class="n">stk</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Executes the items in the stack stk under the control of one Batch controller Operation</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1">#self.write_log( &#39;Preparing Batch controller... &#39; )</span>
        <span class="n">b</span> <span class="o">=</span> <span class="n">b_itm</span><span class="o">.</span><span class="n">data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load_inputs</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
        <span class="n">b</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_op</span><span class="p">(</span><span class="n">b_itm</span><span class="o">.</span><span class="n">tag</span><span class="p">(),</span><span class="n">b</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">appref</span><span class="o">.</span><span class="n">processEvents</span><span class="p">()</span>
        <span class="c1"># After b.run(), it is expected that b.input_list() will refer to a list of dicts,</span>
        <span class="c1"># where each dict has the form [workflow tree uri:input value]. </span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">input_list</span><span class="p">())):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_running</span><span class="p">:</span>
                <span class="n">input_dict</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">input_list</span><span class="p">()[</span><span class="n">i</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">uri</span><span class="p">,</span><span class="n">val</span> <span class="ow">in</span> <span class="n">input_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">set_op_input_at_uri</span><span class="p">(</span><span class="n">uri</span><span class="p">,</span><span class="n">val</span><span class="p">)</span>
                <span class="c1"># inputs are set, run in serial </span>
                <span class="n">thd</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">next_available_thread</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">write_log</span><span class="p">(</span> <span class="s1">&#39;BATCH EXECUTION </span><span class="si">{}</span><span class="s1"> / </span><span class="si">{}</span><span class="s1"> in thread </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">input_list</span><span class="p">()),</span><span class="n">thd</span><span class="p">)</span> <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">run_wf_serial</span><span class="p">(</span><span class="n">stk</span><span class="p">,</span><span class="n">thd</span><span class="p">)</span>
                <span class="n">opdict</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>
                <span class="k">for</span> <span class="n">uri</span> <span class="ow">in</span> <span class="n">b</span><span class="o">.</span><span class="n">saved_items</span><span class="p">():</span>
                    <span class="n">itm</span><span class="p">,</span><span class="n">idx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_from_uri</span><span class="p">(</span><span class="n">uri</span><span class="p">)</span>
                    <span class="n">itm_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">uri_to_dict</span><span class="p">(</span><span class="n">uri</span><span class="p">,</span><span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">itm</span><span class="o">.</span><span class="n">data</span><span class="p">))</span>
                    <span class="n">opdict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">update_uri_dict</span><span class="p">(</span><span class="n">opdict</span><span class="p">,</span><span class="n">itm_dict</span><span class="p">)</span>
                <span class="n">b</span><span class="o">.</span><span class="n">output_list</span><span class="p">()[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">opdict</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">update_op</span><span class="p">(</span><span class="n">b_itm</span><span class="o">.</span><span class="n">tag</span><span class="p">(),</span><span class="n">b</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">write_log</span><span class="p">(</span> <span class="s1">&#39;BATCH EXECUTION TERMINATED&#39;</span> <span class="p">)</span>
                <span class="k">return</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write_log</span><span class="p">(</span> <span class="s1">&#39;BATCH EXECUTION FINISHED&#39;</span> <span class="p">)</span></div>

<div class="viewcode-block" id="WfManager.set_op_input_at_uri"><a class="viewcode-back" href="../../../../moduledoc_files/paws.core.workflow.html#paws.core.workflow.wf_manager.WfManager.set_op_input_at_uri">[docs]</a>    <span class="k">def</span> <span class="nf">set_op_input_at_uri</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">uri</span><span class="p">,</span><span class="n">val</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set an op input, indicated by uri, to provided value.</span>
<span class="sd">        uri must be of the form op_name.inputs.input_name.</span>
<span class="sd">        Currently shallower uris (e.g. op_name.inputs) </span>
<span class="sd">        and deeper uris (e.g. op_name.inputs.input_list.0)</span>
<span class="sd">        are not supported.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">uri</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span>
        <span class="n">op_itm</span><span class="p">,</span> <span class="n">idx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_from_uri</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">op</span> <span class="o">=</span> <span class="n">op_itm</span><span class="o">.</span><span class="n">data</span>
        <span class="n">op</span><span class="o">.</span><span class="n">inputs</span><span class="p">[</span><span class="n">p</span><span class="p">[</span><span class="mi">2</span><span class="p">]]</span> <span class="o">=</span> <span class="n">val</span>
        <span class="n">op</span><span class="o">.</span><span class="n">input_locator</span><span class="p">[</span><span class="n">p</span><span class="p">[</span><span class="mi">2</span><span class="p">]]</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">val</span></div>

    <span class="c1"># Overloaded data() for WfManager</span>
    <span class="c1">#def data(self,itm_idx,data_role):</span>
    <span class="c1">#    return super(WfManager,self).data(itm_idx,data_role)</span>
    <span class="c1">#    #itm = itm_indx.internalPointer()</span>
    <span class="c1">#    #if item_indx.column() == 1:</span>
    <span class="c1">#    #    if item.data is not None:</span>
    <span class="c1">#    #        if ( isinstance(item.data,Operation)</span>
    <span class="c1">#    #            or isinstance(item.data,list)</span>
    <span class="c1">#    #            or isinstance(item.data,dict) ):</span>
    <span class="c1">#    #            return type(item.data).__name__ </span>
    <span class="c1">#    #        else:</span>
    <span class="c1">#    #            return &#39; &#39;</span>
    <span class="c1">#    #    else:</span>
    <span class="c1">#    #        return &#39; &#39;</span>
    <span class="c1">#    #else:</span>

    <span class="c1"># Overloaded headerData() for WfManager </span>
<div class="viewcode-block" id="WfManager.headerData"><a class="viewcode-back" href="../../../../moduledoc_files/paws.core.workflow.html#paws.core.workflow.wf_manager.WfManager.headerData">[docs]</a>    <span class="k">def</span> <span class="nf">headerData</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">section</span><span class="p">,</span><span class="n">orientation</span><span class="p">,</span><span class="n">data_role</span><span class="p">):</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">data_role</span> <span class="o">==</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">DisplayRole</span> <span class="ow">and</span> <span class="n">section</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
            <span class="k">return</span> <span class="s2">&quot;Workflow: </span><span class="si">{}</span><span class="s2"> operation(s)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rowCount</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">QModelIndex</span><span class="p">()))</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">data_role</span> <span class="o">==</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">DisplayRole</span> <span class="ow">and</span> <span class="n">section</span> <span class="o">==</span> <span class="mi">1</span><span class="p">):</span>
            <span class="c1">#return &quot;type&quot;</span>
            <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">WfManager</span><span class="p">,</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">headerData</span><span class="p">(</span><span class="n">section</span><span class="p">,</span><span class="n">orientation</span><span class="p">,</span><span class="n">data_role</span><span class="p">)</span>    
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span></div>

    <span class="c1"># Overload columnCount()</span>
<div class="viewcode-block" id="WfManager.columnCount"><a class="viewcode-back" href="../../../../moduledoc_files/paws.core.workflow.html#paws.core.workflow.wf_manager.WfManager.columnCount">[docs]</a>    <span class="k">def</span> <span class="nf">columnCount</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">parent</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Let WfManager have two columns, one for item tag, one for item type&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="mi">2</span></div></div>



</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../../../../search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../../index.html">paws 0.4.0 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../../index.html" >Module code</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2017, Lenson A. Pellouchoud.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.5.2.
    </div>
  </body>
</html>